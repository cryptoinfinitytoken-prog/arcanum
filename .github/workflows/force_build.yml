name: Arcanum Guaranteed Build

on: [workflow_dispatch]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
      with:
        submodules: recursive

    - name: Install Dependencies
      run: sudo apt update && sudo apt install -y build-essential cmake pkg-config libboost-all-dev libssl-dev libzmq3-dev libunbound-dev libsodium-dev libunwind8-dev liblzma-dev libreadline6-dev libldns-dev libexpat1-dev doxygen graphviz libpgm-dev qttools5-dev-tools libhidapi-dev libusb-1.0-0-dev libprotobuf-dev protobuf-compiler libudev-dev

    - name: Configure Identity (Arcanum)
      run: |
        rm src/cryptonote_config.h
        cat <<EOF > src/cryptonote_config.h
        #pragma once
        #include <string>
        #include <boost/uuid/uuid.hpp>
        #define CRYPTONOTE_DNS_TIMEOUT_MS 20000
        namespace config {
          uint64_t const CRYPTONOTE_PUBLIC_ADDRESS_BASE58_PREFIX = 239;
          uint64_t const CRYPTONOTE_PUBLIC_INTEGRATED_ADDRESS_BASE58_PREFIX = 240;
          uint64_t const CRYPTONOTE_PUBLIC_SUBADDRESS_BASE58_PREFIX = 241;
          uint16_t const P2P_DEFAULT_PORT = 19990;
          uint16_t const RPC_DEFAULT_PORT = 19991;
          uint16_t const ZMQ_RPC_DEFAULT_PORT = 19992;
          boost::uuids::uuid const NETWORK_ID = {{0x12,0x30,0xF1,0x71,0x61,0x04,0x41,0x61,0x17,0x31,0x00,0x82,0x16,0xA1,0xA1,0x10}};
          std::string const CRYPTONOTE_NAME = "arcanum";
          std::string const GENESIS_TX = "013c01ff0001ffffffffffff03029b2e4c0281c0b02e7c53291a94d1d0cbcf74ae0671a93d1d3080948a579ad83121017767aafcde9be00dcfd098715ebcf7f410daebc582fda69d24a28e9d0bc890d1";
          uint32_t const GENESIS_NONCE = 7777;
        }
        namespace config {
          namespace testnet {
            uint64_t const CRYPTONOTE_PUBLIC_ADDRESS_BASE58_PREFIX = 53;
            uint64_t const CRYPTONOTE_PUBLIC_INTEGRATED_ADDRESS_BASE58_PREFIX = 54;
            uint64_t const CRYPTONOTE_PUBLIC_SUBADDRESS_BASE58_PREFIX = 63;
            uint16_t const P2P_DEFAULT_PORT = 28080;
            uint16_t const RPC_DEFAULT_PORT = 28081;
            uint16_t const ZMQ_RPC_DEFAULT_PORT = 28082;
            boost::uuids::uuid const NETWORK_ID = {{0x12,0x30,0xF1,0x71,0x61,0x04,0x41,0x61,0x17,0x31,0x00,0x82,0x16,0xA1,0xA1,0x11}};
            std::string const GENESIS_TX = "013c01ff0001ffffffffffff03029b2e4c0281c0b02e7c53291a94d1d0cbcf74ae0671a93d1d3080948a579ad83121017767aafcde9be00dcfd098715ebcf7f410daebc582fda69d24a28e9d0bc890d1";
            uint32_t const GENESIS_NONCE = 10001;
          }
          namespace stagenet {
            uint64_t const CRYPTONOTE_PUBLIC_ADDRESS_BASE58_PREFIX = 53;
            uint64_t const CRYPTONOTE_PUBLIC_INTEGRATED_ADDRESS_BASE58_PREFIX = 54;
            uint64_t const CRYPTONOTE_PUBLIC_SUBADDRESS_BASE58_PREFIX = 63;
            uint16_t const P2P_DEFAULT_PORT = 38080;
            uint16_t const RPC_DEFAULT_PORT = 38081;
            uint16_t const ZMQ_RPC_DEFAULT_PORT = 38082;
            boost::uuids::uuid const NETWORK_ID = {{0x12,0x30,0xF1,0x71,0x61,0x04,0x41,0x61,0x17,0x31,0x00,0x82,0x16,0xA1,0xA1,0x12}};
            std::string const GENESIS_TX = "013c01ff0001ffffffffffff03029b2e4c0281c0b02e7c53291a94d1d0cbcf74ae0671a93d1d3080948a579ad83121017767aafcde9be00dcfd098715ebcf7f410daebc582fda69d24a28e9d0bc890d1";
            uint32_t const GENESIS_NONCE = 10002;
          }
        }
        EOF

    - name: Compile
      run: make release-static -j2

    - name: Find and Move Binaries (The Fix)
      run: |
        mkdir arcanum_output
        # Find the files wherever they are hiding and copy them to our folder
        find build -name "monerod" -type f -exec cp {} arcanum_output/ \;
        find build -name "monero-wallet-cli" -type f -exec cp {} arcanum_output/ \;
        ls -R arcanum_output

    - name: Upload Binaries
      uses: actions/upload-artifact@v4
      with:
        name: arcanum-linux-x64
        path: arcanum_output/
